<!DOCTYPE html>
<html>
<head>
    <title>AntX System</title>
    <!--<link rel="stylesheet" href="vendor/webix/codebase/webix.css" type="text/css" charset="utf-8">-->
    <link rel="stylesheet" href="vendor/webix/codebase/skins/touch.css" type="text/css" media="screen" charset="utf-8">

    <link rel="apple-touch-icon" sizes="57x57" href="assets/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="assets/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="assets/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="assets/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="assets/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="assets/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="assets/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="assets/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <style type="text/css">
        @media (pointer: coarse) {
            body.webix_full_screen {
                overflow: auto;
            }
        }

        /** QR-scaner container */
        .qr-scanner {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            display: flex;
            width: 100%;
            overflow: hidden;
        }

        /*.webix_template{*/
        /*background-color: antiquewhite !important;*/
        /*}*/
        #qr-scanner {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #000;
            display: none;
            z-index: 1000;
        }

        #preview {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .wallets .webix_dataview_item{
            margin-left: 20px;
            margin-top: 20px;
            background-color: #1b629c;
        }

        .overall > .title,
        .overall > .amount,
        .overall > .year{
            color: #fff;
            font-weight: bold;
        }

    </style>
    <!--<script src="vendor/lodash/lodash.min.js" type="text/javascript" charset="utf-8"></script>-->
    <script src="vendor/jquery/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="vendor/qrcodejs/qrcode.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="vendor/webix/codebase/webix.js" type="text/javascript" charset="utf-8"></script>
    <script src="vendor/schmich/instascan/instascan.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>

<!-- Templates -->
<div style="display: none">

    <!-- QR Scanner -->
    <div id="qr-scanner">
        <button type="button" class="webixtype_base">Back</button>
        <video id="preview"></video>
    </div>

    <!-- Big logo template -->
    <div id="big-logo">
        <div style="text-align: center">
            <img src="assets/logo.jpeg" width="20%" style="max-width: 200px"/>
        </div>
    </div>


    <!-- $ template -->
    <div id="#usdtemplate">
        <div style="text-align: center">
            #total#
        </div>
    </div>
</div>



<script type="text/javascript" charset="utf-8">
    var antx = window.antx = {};

    webix.ready(function() {
        /**
         * Order manager
         *
         * Handle asks, bids and trade history together
         */
        var orderManager = antx.orders = new function() {

            /*
             */
            this.getBids = function(callback) {

                var orders = [];
                for (var i = 0; i < 10; i++) {
                    var sum = Math.round(Math.random() * 3339);
                    orders.push({
                        sum:   sum,
                        total: sum,
                        size:  0.914+0.001*i,
                        bid:   Math.round(Math.random() * 1000)
                    });
                }
                callback(orders)
            };

            this.getAsks = function(callback) {

                callback([{
                    sum:   3333.8,
                    total: 3333.8,
                    size:  0.914,
                    bid:   10000
                }]);
            };
        };

        /**
         * QR scan manager
         *
         * @param videoDomElement
         * @constructor
         */
        var QrScanner = function(videoDomElement) {
            var cameras = [];
            var scanner;
            var currentCamera;

            Instascan.Camera.getCameras().then(function(_cameras) {
                cameras = _cameras;
                if(cameras.length > 0) {
                    currentCamera = cameras[0];
                } else {
                    webix.message({
                        type: "error",
                        text: 'No cameras found.'
                    });
                }
            }).catch(function(e) {
                console.error(e);
            });

            function init() {
                scanner = new Instascan.Scanner({
                    video:      videoDomElement,
                    scanPeriod: 5
                });

            }

            this.start = function() {
                if(!scanner) {
                    init();
                }

                scanner.start(currentCamera);
            };

            this.stop = function() {
                if(!scanner) {
                    init();
                }

                scanner.stop(currentCamera);
            };

            this.onScan = function(callback) {
                if(!scanner) {
                    init();
                }
                return scanner.addListener('scan', callback);
            }
        };

        var qrScanner = $("#qr-scanner");
        var qrScanManager = new QrScanner(qrScanner.find("video")[0]);

        qrScanner.find('button').on('click', function() {
            qrScanner.hide();
            qrScanManager.stop();
        });

        if(webix.CustomScroll && !webix.env.touch) {
            webix.CustomScroll.init();
        }

        var chart = {
            view: "chart",
            id:   "myChart",

            type:      "line",
            value:     "#sales#",
            onContext: {},
            item:      {
                borderColor: "#1293f8",
                color:       "#ffffff"
            },
            line:      {
                color: "#1293f8",
                width: 3
            },
            xAxis:     {
                template: "'#year#"
            },
            offset:    0,
            yAxis:     {
                start:    0,
                end:      100,
                step:     10,
                template: function(obj) {
                    return (obj % 20 ? "" : obj)
                }
            },
            data:      [{
                id:    1,
                sales: 20,
                year:  "06"
            }, {id:    2,
                sales: 55,
                year:  "07"
            }, {id:    3,
                sales: 40,
                year:  "08"
            }, {id:    4,
                sales: 78,
                year:  "09"
            }, {id:    5,
                sales: 61,
                year:  "10"
            }, {id:    6,
                sales: 35,
                year:  "11"
            }, {id:    7,
                sales: 80,
                year:  "12"
            }, {id:    8,
                sales: 50,
                year:  "13"
            }, {id:    9,
                sales: 65,
                year:  "14"
            }, {id:    10,
                sales: 59,
                year:  "15"
            }]
        };
        var asksFrame = {
            view:    "datatable",
            id:      "orderAsks",
            columns: [{
                id:     "sum",
                header: "Sum",
                sort:   "text"
            }, {
                id:     "total",
                header: "Total",
                sort:   "text"
            }, {
                id:        "size",
                fillspace: 1,
                header:    "Size",
                sort:      "text"
            }, {
                id:        "bid",
                fillspace: 1,
                header:    "Bid",
                sort:      "text"
            }],

            autoheight: true, // autowidth:  true,
            // width: 1000,

            on: {
                onStructureLoad: function() {
                    var dataTable = this;
                    window.setInterval(function() {
                        console.log("OYeah!");
                        dataTable.clearAll();
                        antx.orders.getBids(function(orders) {
                            dataTable.parse(orders);
                            dataTable.refresh();
                        });
                    }, 1000);
                }
            },
        };


        var introFrame = {
            id:   "introFrame",
            rows: [{
                view:  "button",
                label: "Registration",
                on:    {
                    onItemClick: function(id) {
                        $$('setupPinFrame').show();
                    }
                }

            }, {
                view:  "button",
                label: "Scan QR-Code",
                on:    {
                    onItemClick: function(id) {
                        qrScanner.show();
                        qrScanManager.start();
                        qrScanManager.onScan(function(content, image) {
                            webix.message({
                                type: "info",
                                text: "QR Code value:\n" + content
                            });

                        });
                        webix.message({
                            type: "info",
                            text: "Please, scan saved QR Code"
                        });
                    }
                }
            }]
        };

        var setupPinFrame = {
            id:   "setupPinFrame",
            rows: [{
                view:     "form",
                id:       "setupPinForm",
                width:    300,
                elements: [{
                    view:  "text",
                    type:  "password",
                    label: "Pin",
                    name:  "pin1"

                }, {
                    view:  "text",
                    type:  "password",
                    label: "Pin",
                    name:  "pin2"
                }, {
                    margin: 5,
                    cols:   [{
                        view:  "button",
                        value: "Save",
                        type:  "form",
                        on:    {
                            onItemClick: function(id) {
                                var pins = $$("setupPinForm").getValues();
                                var pin = pins.pin1;

                                if(pin != pins.pin2) {
                                    webix.message({
                                        type: "info",
                                        text: "Please give same PIN code"
                                    });
                                    return;
                                }

                                if(!pin.match(/^\d{4,8}$/)) {
                                    webix.message({
                                        type: "info",
                                        text: "Please setup between 4 and 8 numbers"
                                    });
                                    return;
                                }

                                webix.storage.local.put("pin", pin);

                                webix.message({
                                    type: "info",
                                    text: "Congratulation! Pin code is saved!"
                                });
                                $$('exportCodesFrame').show();

                            }
                        }
                    }, {
                        view:  "button",
                        value: "Cancel",
                        on:    {
                            onItemClick: function(id) {
                                $$('introFrame').show();
                            }
                        }

                    }]
                }]
            }]
        };

        var exportCodesFrame = {
            id:   "exportCodesFrame",
            rows: [{
                template: function(obj) {
                    window.setTimeout(function() {
                        var pin = webix.storage.local.get("pin");
                        var math
                        var qrcode = new QRCode("qrcode", {
                            text:         "http://jindo.dev.naver.com/collie",
                            width:        128,
                            height:       128,
                            colorDark:    "#000000",
                            colorLight:   "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        qrcode.makeCode("http://antx.io/#pin" + pin);
                    }, 10);
                    return "Please save you PIN code as QR image: <div id=\"qrcode\" style=\"width:256px; height:256px; margin-top:15px;\"></div>";
                }
            }, {
                view:  "button",
                value: "Cancel",
                on:    {
                    onItemClick: function(id) {
                        $$('introFrame').show();
                    }
                }

            }]
        };

        webix.ui({
            id: 'mainMenu',
            rows:[
                {
                    view: "toolbar", id:"toolbar", elements:[
                        {
                            view: "icon", icon: "bars",
                            click: function(){
                                if( $$("menu").config.hidden){
                                    $$("menu").show();
                                }
                                else
                                    $$("menu").hide();
                            }
                        },
                        {
                            view: "label",
                            label: "AntX"
                        },{
                            type: "button",
                            label: "Help"
                        }

                    ]
                }, {
                    margin:  10,
                    padding: 0, // view:    "flexlayout",
                    id:      "mainView",
                    rows:    [{
                        align:      "center",
                        template:   "html->big-logo",
                        autoheight: true
                    }, {
                        align: "center",
                        id:    "introNavigation",
                        cells: [introFrame, setupPinFrame, exportCodesFrame]
                    }]
                }]
        });

        webix.ui({
            view:     "sidemenu",
            id:       "menu",
            width:    200,
            position: "left",
            state:    function(state) {
                var toolbarHeight = $$("toolbar").$height;
                state.top = toolbarHeight;
                state.height -= toolbarHeight;
            },
            css:      "my_menu",
            body:     {
                view:  "list",
                click: function(id, event, dom) {
                    // $$("mainView").hide();
                    if(id === 'orders') {
                        webix.ui([{template:"BTC to AntX-EUR", height: 30},{

                            padding: 10,
                            cols: [{
                                rows: [{
                                    view:  "label",
                                    label: "Asks"
                                }, asksFrame]
                            },{template:' ', width: 1}, {
                                rows: [{
                                    view:  "label",
                                    label: "Bids"
                                }, {
                                    view:    "datatable", // id:      "orderAsks",
                                    columns: [{
                                        id:     "sum",
                                        header: "Sum",
                                        sort:   "text"
                                    }, {
                                        id:     "total",
                                        header: "Total",
                                        sort:   "text"
                                    }, {
                                        id:        "size",
                                        fillspace: 1,
                                        header:    "Size",
                                        sort:      "text"
                                    }, {
                                        id:        "bid",
                                        fillspace: 1,
                                        header:    "Bid",
                                        sort:      "text"
                                    }],

                                    autoheight: true, // autowidth:  true,
                                    // width: 1000,

                                    on: {
                                        onStructureLoad: function() {
                                            var dataTable = this;
                                            window.setInterval(function() {
                                                console.log("OYeah!");
                                                dataTable.clearAll();
                                                antx.orders.getBids(function(orders) {
                                                    dataTable.parse(orders);
                                                    dataTable.refresh();
                                                });
                                            }, 1000);
                                        }
                                    }
                                }]
                            }]
                        }], $$("mainView"));
                    }

                    if(id === 'wallets') {
                        webix.ui([{
                            // id:     "walletList",
                            view:   "dataview",
                            select: 1,
                            css:    "wallets",
                            type:   {
                                width:    261,
                                height:   90,
                                margin:   10,
                                template: "<div class='overall'><div class='title'>#blockChain# (#id#)</div><div class='amount'>#amount#</div></div>"
                            },
                            click:  function(id, event, dom) {
                                console.log(id)
                            },
                            data:   [{
                                blockChain: 'Antx$',
                                id:      "ANTX-USD",
                                amount:     115.3
                            }, {
                                blockChain: 'Bitcoin',
                                id:      "BTC",
                                amount:     0.5
                            }, {
                                blockChain: 'AntX',
                                id:      "ANTX",
                                amount:     0.5
                            }, {
                                blockChain: 'Etherium',
                                id:      "ETH",
                                amount:     2.3
                            },]
                        }], $$("mainView"));

                    }

                    if(id === 'settings') {

                        webix.ui([{
                            view:  'label',
                            label: 'Language'
                        }, {
                            view:    "segmented",
                            options: ["Russian", "English"]
                        }], $$("mainView"));

                    }

                    if(id === 'help') {

                        webix.ui([{
                            template: 'Please read official documentation <a href="http://antx.tech" target="antx.tech">here</a>',
                        }], $$("mainView"));

                    }
                },
                borderless: true,
                scroll:     false,
                template:   "<span class='webix_icon fa-#icon#'></span> #value#",
                data:       [{
                    id:    'wallets',
                    value: "Wallets",
                    icon:  "user"
                }, {
                    id:    'orders',
                    value: "Orders",
                    icon:  "cube"
                }, {
                    id:    'settings',
                    value: "Settings",
                    icon:  "cog"
                }, {
                    id:    'help',
                    value: "Help",
                    icon:  "info"
                }],
                select:     true,
                type:       {
                    height: 40
                }
            }
        });


        webix.ui.fullScreen();
    })
</script>
</body>
</html>